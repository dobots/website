<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="Distributed Organisms B.V., shorthand DoBots, specializes in Smart Robots and Smart Buildings. DoBots implements localization, mapping, and navigation algorithms on robots and indoor localization, automation, and tracking algorithms in buildings.">
<meta name="author" content="Distributed Organisms B.V.">
<link rel="icon" type="image/x-icon" href="/images/favicon.ico?">
<link rel="apple-touch-icon" href="/images/apple-touch-icon.png">
<link rel="apple-touch-icon" sizes="72x72" href="/images/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="114x114" href="/images/apple-touch-icon-114x114.png">


<title>DoBots | Asus Xtion on UDOO with OpenNI2 and ROS</title>


<meta name="description" content="A Tutorial on how to setup the Xtion on a UDOO using OpenNI2 and ROS">

<link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">

<link rel="stylesheet" type="text/css" href="/assets/elusive-webfont-b4b08c54aa385fbc9433a5864604eb0a37430d49016644f6c2225b9c9f6528d4.css">

<!-- Custom styles for this template -->

<link rel="stylesheet" type="text/css" href="/assets/flexslider-af37d743866caa19c33f16fdb8585f2b6331c7b25bfcb9b0b2fd4720d61df9b5.css">
<link rel="stylesheet" type="text/css" href="/assets/dobots-style-6a93bbafd311befa179f35a7f457349cb1b7ed24686877defdb4530f84dcc1fe.css">

<!--[if lt IE 9]>
	<script src="/assets/themes//resources/respond/Respond.min.js"></script>
<![endif]-->

<link href="/atom.xml" type="application/atom+xml" rel="alternate" title="Sitewide ATOM Feed">
<link href="/rss.xml" type="application/rss+xml" rel="alternate" title="Sitewide RSS Feed">


</head>

<body>
    <!--
<div id="headerBar" onclick="location.href='http://crownstone.rocks';">
<center>
<h4>
<a href="http://crownstone.rocks/">http://crownstone.rocks</a> power outlet!
</h4>
</center>
</div>
    -->
<header id="header" class="mini-wrap">
	<div class="navbar navbar-inverse" role="navigation">
		<div class="container">
			<div class="navbar-header">
				<button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
					<span class="sr-only">Toggle navigation</span>
					<span class="icon-bar"></span>
					<span class="icon-bar"></span>
					<span class="icon-bar"></span>
				</button>
				<a class="navbar-brand" href="/"><img src="/images/logo.png" class="img-responsive" alt="DoBots"></a>
			</div>

			<div class="collapse navbar-collapse">
				<ul class="nav navbar-nav navbar-right main-nav">
					
					
					


  
    
      
    
  
    
      
      	
      	<li><a href="/applications/cleaning/">Applications</a></li>
      	
      
    
  
    
      
    
  
    
      
      	
      	<li><a href="/products/autopilot/">Technology</a></li>
      	
      
    
  
    
      
    
  
    
      
      	
      	<li><a href="/jobs/">Jobs</a></li>
      	
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
      	
      	<li><a href="/blog/">Blog</a></li>
      	
      
    
  
    
      
    
  
    
      
    
  
    
      
      	
      	<li><a href="/about-us/">About</a></li>
      	
      
    
  
    
      
    
  
    
      
      	
      	<li><a href="/search/">Search</a></li>
      	
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
	<li><a href="mailto:info@dobots.nl?subject=Get%20in%20contact">Contact</a></li>




				</ul>
			</div>
		</div>
	</div>
</header>

<section id="sub-menu" class="mini-wrap">
	<div class="container">
		<div class="row">
			<div class="col-md-12">
				<ul class="list-unstyled sub-menu pull-left slogan">
					<!--					<li>"Computers, come, join us in the real world!"</li> -->
					<li>
<a href="/2014/05/23/best-european-startup/">Best European Startup Award</a> winner of <a href="http://robotlaunch.com/">Robot Launch</a>!
					</li>
				</ul>
                <!--
				<ul class="list-unstyled sub-menu pull-right">
					
						
					
						
					
						
					
						
					
						
					
						
					
						
					
						
					
						
					
						
					
						
					
						
					
						
					
						
					
						
					
						
					
						
					
						
					
						
					
						
					
						
					
					
						
						
							
							
							
							
							
								
							
								
							
								
							
								
							
								
							
								
							
								
							
								
							
								
							
								
							
								
							
								
							
								
							
								
							
								
							
								
							
								
							
								
							
								
							
								
							
								
							
						
					
				</ul>
                -->
			</div>
		</div>
	</div>
</section> <!--end / sub-menu-->


<!--
<div class="page-header">
  <h1>Asus Xtion on UDOO with OpenNI2 and ROS </h1>
</div>
-->

<div class="container">
	<div class="row post-full">
		<div class="col-md-12">
			<div class="date">
				<strong class="date_month">May</strong>
				<strong class="date_day">5</strong>
				<strong class="date_year">2014</strong>
				<!--      <span>05 May 2014</span> -->
			</div>
			
			
			<div class="author-block">
				
				<img src="https://secure.gravatar.com/avatar/ca712f67c149fb1b49fdd673a4a758a5?s=40">
				
				<span class="author">Dominik Egger</span>
			</div>
			
			<div class="post">
				<div class="content">
					
<h1 id="asus-xtion-on-udoo-with-openni2-and-ros">Asus Xtion on UDOO with OpenNI2 and ROS</h1>

<p><img src="/attachments/udoo,xtion,openni2.png" alt="Asus Xtion on UDOO" title="Asus Xtion on UDOO"></p>

<p>This step by step tutorial shows how to setup the <a href="http://www.udoo.org/">UDOO</a> in order to use an Asus Xtion with ROS. If ROS is not necessary, follow <a href="http://feilipu.me/2013/11/09/udoo-ubuntu-12-04-guide/">this</a> tutorial alternatively and go directly to step 2.</p>

<h2 id="step-1-install-ros-on-udoo">Step 1: Install ROS on UDOO</h2>

<p>To use ROS on the UDOO set up an sdcard with an ubuntu core, following the steps described <a href="http://wiki.ros.org/hydro/Installation/UDOO">here</a> with these modifications:</p>

<ol>
  <li>
    <p>Instead of downloading the kernel, u-boot and modules seperately, download the Update Package found under the tab Driver &amp; Tools on the udoo download page <a href="http://www.udoo.org/downloads/">here</a></p>
  </li>
  <li>
    <p>Depending on the udoo cpu, use the following command to flash the boot sector: (replace by u-boot-q.imx for the quad)</p>

    <pre><code> sudo dd if=u-boot-d.imx of=/dev/sdb bs=512 seek=2 status=noxfer
</code></pre>
  </li>
  <li>
    <p>Fix hostname problem. first add a correct hostname <host_name></host_name></p>

    <pre><code> sudo nano /etc/hostname
</code></pre>

    <p>then add that hostname to the file /etc/hosts</p>

    <pre><code> sudo nano /etc/hosts
</code></pre>

    <p>by adding this line (Replace <host_name> with the hostname defined above)</host_name></p>

    <pre><code> 127.0.0.1 	localhost &lt;HOST_NAME&gt;
</code></pre>

    <p>then reboot.</p>
  </li>
  <li>
    <p>To use the WiFi module, the firmware has to be installed seperately and can be found <a href="https://packages.debian.org/sid/firmware-ralink">here</a></p>

    <pre><code> sudo dpkg -i firmware-ralink_0.41_all.deb
</code></pre>
  </li>
</ol>

<h2 id="step-2-install-openni2-driver">Step 2: Install OpenNI2 Driver</h2>

<h3 id="minimal-install">Minimal Install</h3>

<p>To use OpenNI2 with ROS, we only need the shared OpenNI2 libraries and the Drivers. Java is not necessary and doesn’t need to be compiled. So to avoid installing and using up unneccessary space, I describe here first the minimal solution, and later the additions necessary to compile the java code and create an archive.</p>

<p>Install the following dependencies:</p>

<pre><code>sudo apt-get install git g++ make python libusb-1.0-0-dev libudev-dev pkg-config
</code></pre>

<p>clone OpenNI2</p>

<pre><code>git clone https://github.com/OpenNI/OpenNI2
cd OpenNI2
</code></pre>

<p>edit ThirdParty/PSCommon/BuildSystem/Platform.Arm</p>

<pre><code>nano ThirdParty/PSCommon/BuildSystem/Platform.Arm
</code></pre>

<p>and replace</p>

<pre><code>CFLAGS += -march=armv7-a -mtune=cortex-a9 -mfpu=neon -mfloat-abi=softfp #-mcpu=cortex-a8
</code></pre>

<p>with</p>

<pre><code>CFLAGS += -march=armv7-a -mtune=cortex-a9 -mfpu=neon -mfloat-abi=hard
</code></pre>

<p>then run make to compile the OpenNI2 drivers and libraries</p>

<pre><code>PLATFORM=Arm make
</code></pre>

<p>Note: Because of the missing java compiler, the compilation will fail with OpenNI.java, and javac not found. This is ok since the drivers and shared libraries are already compiled at this point. The only thing missing are the samples.</p>

<p>Once the compilation is done, run the linux install script</p>

<pre><code>cd /Packaging/Linux
sudo ./install.sh
</code></pre>

<p>copy libraries and includes to the system paths</p>

<pre><code>sudo cp -r Include /usr/include/openni2
sudo cp -r Bin/Arm-Release/OpenNI2 /usr/lib/
sudo cp Bin/Arm-Release/libOpenNI2.* /usr/lib/
</code></pre>

<p>create a package config file</p>

<pre><code>sudo nano /usr/lib/pkgconfig/libopenni2.pc
</code></pre>

<p>and fill it with this:</p>

<pre><code>prefix=/usr
exec_prefix=${prefix}
libdir=${exec_prefix}/lib
includedir=${prefix}/include/openni2

Name: OpenNI2
Description: A general purpose driver for all OpenNI cameras.
Version: 2.2.0.0
Cflags: -I${includedir}
Libs: -L${libdir} -lOpenNI2 -L${libdir}/OpenNI2/Drivers -lDummyDevice -lOniFile -lPS1080.so
</code></pre>

<p>this will enable ubuntu to find the location of the drivers, libraries and include files.</p>

<p>To make sure it is correctly found, run</p>

<pre><code>pkg-config --modversion libopenni2
</code></pre>

<p>which should give the same version as defined in the file above (2.2.0.0)</p>

<p>Now the Xtion is ready to be used. Plug it in (if it is already, unplug it first), then run the sample program</p>

<pre><code>./Bin/Arm-Release/SimpleRead
</code></pre>

<p>Note: For the minimal install, the samples need to be compiled first. Add the following line to the makefile at the end</p>

<pre><code>core_samples: $(CORE_SAMPLES)
</code></pre>

<p>then run</p>

<pre><code>PLATFORM=Arm make core_samples
</code></pre>

<p>to compile the samples.</p>

<p>The SimpleRead returns the readings of middle point in the sensor data</p>

<pre><code>./Bin/Arm-Release/SimpleRead
	[00066738]      631
	[00100107]      641
	[00133477]      654
	[00166846]      662
	[00200215]      670
	[00233584]      677
	[00266954]      679
	[00300323]      678
	[00333692]      675
	[00367061]      669
	[00400431]      657
	[00433800]      644
	[00467169]      629
	[00500538]      611
	[00533908]      592
	...
</code></pre>

<h3 id="full-install">Full Install</h3>

<p>in addition to the dependencies of the minimal install, the default-jdk package is needed:</p>

<pre><code>sudo apt-get install default-jdk
</code></pre>

<p>now running</p>

<pre><code>PLATFORM=Arm make
</code></pre>

<p>will compile the drivers, shared libraries, jar files and samples.</p>

<p>If a compressed archive with the drivers and libraries is needed, install the following:</p>

<pre><code>sudo apt-get install doxygen
</code></pre>

<p>then run</p>

<pre><code>cd Packaging
./ReleaseVersion.py Arm
</code></pre>

<p>which creates the archive OpenNI-Linux-Arm-2.2.tar.bz2 in Packaging/Final/</p>

<h2 id="step-3-install-ros-packages-to-run-the-asus-xtion">Step 3: Install ROS Packages to run the Asus Xtion</h2>

<p>The packages used to run the Asus Xtion on the UDOO are not availbale over apt yet, so they need to be compiled from source</p>

<p>First install the following dependencies, which will take some time and space (~900MB):</p>

<pre><code>sudo apt-get install ros-hydro-ros ros-hydro-rostopic ros-hydro-nodelet ros-hydro-camera-info-manager ros-hydro-roscpp ros-hydro-sensor-msgs ros-hydro-dynamic-reconfigure ros-hydro-image-transport ros-hydro-image-proc ros-hydro-depth-image-proc ros-hydro-tf 
</code></pre>

<p>then create a catkin workspace as described <a href="http://wiki.ros.org/catkin/Tutorials/create_a_workspace">here</a>, and check out the following packages in the src folder of the catkin workspace:</p>

<pre><code>git clone https://github.com/ros-drivers/openni2_camera
git clone https://github.com/ros-drivers/openni2_launch
git clone https://github.com/ros-drivers/rgbd_launch
</code></pre>

<p>Now the ros packages checked out above to the catkin workspace can be compiled with catkin_make</p>

<pre><code>cd ~/catkin_ws
catkin_make
</code></pre>

<p>Once the packages are compiled, the Xtion is ready for use with ROS with</p>

<pre><code>roslaunch openni2_launch openni2.launch
</code></pre>

<p>Performance on the UDOO is good with 30 Hz at 640x480, compared to the Raspberry Pi that can only provide 30 Hz at 320x240 under no other load.</p>


				</div>

				

				
				<div class="tag_box inline">
					<i class="icon-tags"></i>

					
					


  
     
    	<a href="/tags.html#xtion-ref">xtion</a> 
     
    	<a href="/tags.html#openni2-ref">openni2</a> 
     
    	<a href="/tags.html#ros-ref">ros</a> 
     
    	<a href="/tags.html#udoo-ref">udoo</a> 
    
  




				</div>
				
				<hr>

				<div class="social-button-footer">
					<p>
					<a class="btn btn-social-icon btn-twitter" href="http://twitter.com/intent/tweet?url=https://dobots.nl/2014/05/05/asus-xtion-using-openni2-and-ros-on-udoo&amp;text=Asus%20Xtion%20on%20UDOO%20with%20OpenNI2%20and%20ROS"><i class="icon-twitter"></i></a>
					<a class="btn btn-social-icon btn-facebook" href="http://facebook.com/sharer.php?u=https://dobots.nl/2014/05/05/asus-xtion-using-openni2-and-ros-on-udoo"><i class="icon-facebook"></i></a>
					<a class="btn btn-social-icon btn-googleplus" href="https://plus.google.com/share?url=https://dobots.nl/2014/05/05/asus-xtion-using-openni2-and-ros-on-udoo"><i class="icon-googleplus"></i></a>
					<a class="btn btn-social-icon btn-linkedin" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https://dobots.nl/2014/05/05/asus-xtion-using-openni2-and-ros-on-udoo"><i class="icon-linkedin"></i></a>
					<a class="btn btn-social-icon btn-reddit" href="http://reddit.com/submit?url=https://dobots.nl/2014/05/05/asus-xtion-using-openni2-and-ros-on-udoo&amp;title=Asus%20Xtion%20on%20UDOO%20with%20OpenNI2%20and%20ROS"><i class="icon-reddit"></i></a>
					</p>
				</div>


				<ul class="pagination">
					
					<li class="prev"><a href="/2014/03/05/rfduino-without-rfduino-code" title="RFduino without RFduino code">← Previous</a></li>
					
					<li><a href="/blog">Archive</a></li>
					
					<li class="next"><a href="/2014/05/23/best-european-startup" title="Best European Startup">Next →</a></li>
					
				</ul>
				<hr>
				


  <div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_shortname = 'dobots'; 
    
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a>
</noscript>
<a href="https://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>




			</div>
		</div>
	</div>



<footer id="footer" class="mini-wrap gray">
	<div class="container">
		<div class="row">
			<div class="col-xs-6 col-sm-6 col-md-6 more-padding">
				<img src="/images/youtube.png" alt="youtube"> Watch our <a href="https://www.youtube.com/channel/UC7bsuzp2BfL5F5RX07oLIzw">movies</a> and follow us on <a href="http://facebook.com/dobots">Facebook!</a>
</div>
			<div class="col-xs-6 col-sm-6 col-md-6">
				<ul class="list-items pull-right gutter-top-btm">
					<li><a href="index.html">
						<img src="/images/footer-logo.png" class="img-responsive" alt="DoBots"></a></li>
					<li class="robot-info-dilog">
<a href="#">
						<img src="/images/two-robot.png" width="103" height="85" alt="robot">
					</a>
					<div class="footer-robot-dilog">
						<div class="inner-robot-dilog">
							Do you have a question? <script type="text/javascript">/*<![CDATA[*/var a=new Array(".nl","bots","do","@","fo","in");document.write("<a href='mailto:");for(i=a.length-1;i>=0;i--){document.write(a[i])}document.write("?subject=DoBots Contact' class='btn btn-default'>Yes</a>");/*]]>*/</script>
							<div class="inner-arrow-right">
								<img alt="dilog" class="img-responsive" src="/images/inner-dilog.png" draggable="false"> </div>
						</div>

					</div>
					</li>
				</ul>

			</div>
		</div>
	</div>
</footer>




  <script type="text/javascript">
window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
ga('create', 'UA-17146802-10', 'auto');
ga('send', 'pageview');
</script>
<script type="text/javascript" async src="https://www.google-analytics.com/analytics.js"></script>






<!-- in debug mode, Google Chrome worries about .map files, do not worry -->


<script type="text/javascript" src="/assets/jquery.min-7f30f220312176c728c3bb41a567ccc2e1ce2e7a8dd7c9cefd59fe197ba047b2.js"></script>

<!-- Latest compiled and minified JavaScript -->
<script src="//maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
<script type="text/javascript" src="/assets/jquery.flexslider-122776e067a7b77f685ce8fbbd3cb75136ce8ca23f243a50de28c1545ec6bb68.js"></script>

<script type="text/javascript" async src="//cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>

<script type="text/javascript">
$(window).load(function(){
		$('.text-slider').flexslider({
			animation: "slide",
			start: function(slider){
				$('body').removeClass('loading');
			}
		});
	});
</script>

</div>
</body>
</html>
