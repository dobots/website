<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="Distributed Organisms B.V., shorthand DoBots, specializes in Smart Robots and Smart Buildings. DoBots implements localization, mapping, and navigation algorithms on robots and indoor localization, automation, and tracking algorithms in buildings.">
<meta name="author" content="Distributed Organisms B.V.">
<link rel="icon" type="image/x-icon" href="/images/favicon.ico?">
<link rel="apple-touch-icon" href="/images/apple-touch-icon.png">
<link rel="apple-touch-icon" sizes="72x72" href="/images/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="114x114" href="/images/apple-touch-icon-114x114.png">


<title>DoBots | RPlidar vs kinect's laserscan with RTabmap on turtlebot</title>


<meta name="description" content="How to mount the RPlidar on your turtlebot and configure rtabmap to use it. Overview of the results">

<link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">

<link rel="stylesheet" type="text/css" href="/assets/elusive-webfont-b4b08c54aa385fbc9433a5864604eb0a37430d49016644f6c2225b9c9f6528d4.css">

<!-- Custom styles for this template -->

<link rel="stylesheet" type="text/css" href="/assets/flexslider-af37d743866caa19c33f16fdb8585f2b6331c7b25bfcb9b0b2fd4720d61df9b5.css">
<link rel="stylesheet" type="text/css" href="/assets/dobots-style-6a93bbafd311befa179f35a7f457349cb1b7ed24686877defdb4530f84dcc1fe.css">

<!--[if lt IE 9]>
	<script src="/assets/themes//resources/respond/Respond.min.js"></script>
<![endif]-->

<link href="/atom.xml" type="application/atom+xml" rel="alternate" title="Sitewide ATOM Feed">
<link href="/rss.xml" type="application/rss+xml" rel="alternate" title="Sitewide RSS Feed">


</head>

<body>
    <!--
<div id="headerBar" onclick="location.href='http://crownstone.rocks';">
<center>
<h4>
<a href="http://crownstone.rocks/">http://crownstone.rocks</a> power outlet!
</h4>
</center>
</div>
    -->
<header id="header" class="mini-wrap">
	<div class="navbar navbar-inverse" role="navigation">
		<div class="container">
			<div class="navbar-header">
				<button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
					<span class="sr-only">Toggle navigation</span>
					<span class="icon-bar"></span>
					<span class="icon-bar"></span>
					<span class="icon-bar"></span>
				</button>
				<a class="navbar-brand" href="/"><img src="/images/logo.png" class="img-responsive" alt="DoBots"></a>
			</div>

			<div class="collapse navbar-collapse">
				<ul class="nav navbar-nav navbar-right main-nav">
					
					
					


  
    
      
    
  
    
      
      	
      	<li><a href="/applications/cleaning/">Applications</a></li>
      	
      
    
  
    
      
    
  
    
      
      	
      	<li><a href="/products/autopilot/">Technology</a></li>
      	
      
    
  
    
      
    
  
    
      
      	
      	<li><a href="/jobs/">Jobs</a></li>
      	
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
      	
      	<li><a href="/blog/">Blog</a></li>
      	
      
    
  
    
      
    
  
    
      
    
  
    
      
      	
      	<li><a href="/about-us/">About</a></li>
      	
      
    
  
    
      
    
  
    
      
      	
      	<li><a href="/search/">Search</a></li>
      	
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
	<li><a href="mailto:info@dobots.nl?subject=Get%20in%20contact">Contact</a></li>




				</ul>
			</div>
		</div>
	</div>
</header>

<section id="sub-menu" class="mini-wrap">
	<div class="container">
		<div class="row">
			<div class="col-md-12">
				<ul class="list-unstyled sub-menu pull-left slogan">
					<!--					<li>"Computers, come, join us in the real world!"</li> -->
					<li>
<a href="/2014/05/23/best-european-startup/">Best European Startup Award</a> winner of <a href="http://robotlaunch.com/">Robot Launch</a>!
					</li>
				</ul>
                <!--
				<ul class="list-unstyled sub-menu pull-right">
					
						
					
						
					
						
					
						
					
						
					
						
					
						
					
						
					
						
					
						
					
						
					
						
					
						
					
						
					
						
					
						
					
						
					
						
					
						
					
						
					
						
					
					
						
						
							
							
							
							
							
								
							
								
							
								
							
								
							
								
							
								
							
								
							
								
							
								
							
								
							
								
							
								
							
								
							
								
							
								
							
								
							
								
							
								
							
								
							
								
							
								
							
						
					
				</ul>
                -->
			</div>
		</div>
	</div>
</section> <!--end / sub-menu-->


<!--
<div class="page-header">
  <h1>RPlidar vs kinect's laserscan with RTabmap on turtlebot </h1>
</div>
-->

<div class="container">
	<div class="row post-full">
		<div class="col-md-12">
			<div class="date">
				<strong class="date_month">Feb</strong>
				<strong class="date_day">5</strong>
				<strong class="date_year">2015</strong>
				<!--      <span>05 February 2015</span> -->
			</div>
			
			
			<div class="post">
				<div class="content">
					
<h2 id="rplidar-overview">RPlidar overview</h2>

<p>The RPlidar is a 360° SLAM-ready laser scanner. It is amongst the cheapest of its kind and yet, it offers accurated measures.</p>

<p>More info and where to find it: <a href="http://www.robotshop.com/en/rplidar-360-laser-scanner.html">robotshop</a></p>

<p><img src="/attachments/rplidar-360-laser-scanner.jpg" alt="RPlidar laser scan" title="RPlidar laser scan" style="width: 140px"></p>

<h2 id="rtabmap-overview">RTabmap overview</h2>

<p>RTabmap is a real-time RGB-D graph SLAM approach developped by  M.Labbé and F.Michaud, from the IntRoLab.</p>

<p>More info and where to find: <a href="http://introlab.github.io/rtabmap/">RTabmap official website</a></p>

<h2 id="mounting-the-rplidar-on-the-turtlebot">Mounting the RPlidar on the turtlebot</h2>

<p>First, you have to physically mount the laser on your turtlebot. Get your drill, a screwdriver and screw it on an empty plate! I fixed mine just above the kinect:</p>

<p><img src="/attachments/rplidar_on_turtlebot.jpg" alt="RPlidar on turtlebot" title="RPlidar on turtlebot" style="width: 280px"></p>

<p>The next step is to update your turtlebot’s description files to include the laser.
We need to find which plate is the laser fixed to:</p>

<pre><code>roscd turtlebot_description/urdf/stacks
gedit circles.urdf.xacro
</code></pre>

<p>In my case, it was:</p>

<pre><code>    &lt;joint name="plate_3_joint" type="fixed"&gt;
      &lt;origin xyz="-0.01316 0 0.2063496" rpy="0 0 0" /&gt;
      &lt;parent link="plate_2_link"/&gt;
      &lt;child link="plate_3_link" /&gt;
    &lt;/joint&gt;
</code></pre>

<p>How to find it: the plate_3 was 20cm above plate_2 so I knew parent link=plate_2_link and Z=~0.20
Then, we need to adjust the position of the laser relative to its plate.</p>

<pre><code>roscd turtlebot_create/../create_description/urdf
gedit create.urdf.xacro
</code></pre>

<p>Modify: (coordinates in meters of the center of the rotating part of the laser, rotations in radians.)</p>

<pre><code>	  &lt;joint name="laser_joint" type="fixed"&gt;
	    &lt;origin xyz="[PositionX] [PositionY] [PositionZ]" rpy="[rotation/X] [rotation/Y] [rotation/Z]" /&gt;
	    &lt;parent link="[plate on which the laser is]" /&gt;
	    &lt;child link="laser" /&gt;
	  &lt;/joint&gt;
</code></pre>

<p>visualize Turtlebot on rviz to make sure your parameters are good, open two terminals and start:</p>

<pre><code>roslaunch turtlebot_bringup minimal.launch
rosrun rviz rviz
</code></pre>

<p>in rviz: add -&gt; robot model (you may have to change the fixed frame to base_link)
You should see something like this:</p>

<p><img src="/attachments/turtlebot_visualisation.jpg" alt="turtlebot visualisation" title="Turtlebot Visualisation" style="width: 280px"></p>

<p>Where the green rectangle represent the RPlidar.</p>

<h2 id="installing-ros-packages-for-the-rplidar">Installing ROS packages for the RPlidar</h2>

<p>I installed it from source, which you can find here: <a href="https://github.com/robopeak/rplidar_ros">https://github.com/robopeak/rplidar_ros</a></p>

<pre><code>cd catkin_ws/src
git clone https://github.com/robopeak/rplidar_ros.git rplidar
cd ..
catkin_make
source devel/setup.bash
</code></pre>

<p>You may have to change the ttyUSBX defined in rplidar.launch to have it working with along the turtlebot.</p>

<pre><code>roscd rplidar_ros/launch
gedit rplidar.launch
</code></pre>

<h2 id="configuring-the-turtlebot-launch-file">Configuring the turtlebot launch file</h2>
<p>Now, we want to generate the scan topic from the RPlidar and the kinect to compare them with RTabmap.
Therefore, we have to change the name of the scan topic from the kinect.</p>

<pre><code>roscd turtlebot_bringup/launch
gedit 3dsensor.launch
</code></pre>

<p>change</p>

<pre><code>  &lt;!-- Laserscan topic --&gt;
 	 &lt;arg name="scan_topic" default="scan"/&gt;
</code></pre>

<p>to</p>

<pre><code>  &lt;!-- Laserscan topic --&gt;
  &lt;arg name="scan_topic" default="scan_kinect"/&gt;
</code></pre>

<h2 id="configuring-rtabmap-launch-file">Configuring RTabmap launch file</h2>

<p>Now that we have a working rplidar publishing on /scan and a kinect publishing an emulated scan on /scan_kinect, we have to modify our rtabmap launch file to include one or another.
The easiest and most convenient way is to define an argument scan_topic which can be either /scan or /scan_kinect.</p>

<p>Edit your favorite launch file this way (e.g. rgbd_mapping.launch):</p>

<pre><code>roscd rtabmap_ros/launch
gedit rgbd_mapping.launch
</code></pre>

<p>Add this line under the other arguments:</p>

<pre><code>   &lt;arg name="scan_topic" default="/scan"/&gt;
</code></pre>

<p>then change the line remapping the scan_topic in the visual SLAM and the visulation node to</p>

<pre><code>      &lt;remap from="scan" to="$(arg scan_topic)"/&gt;
</code></pre>

<p>Make sur you have set the subscribe_laserScan to true in those nodes:</p>

<pre><code>      &lt;param name="subscribe_laserScan" type="bool" value="true"/&gt;
</code></pre>

<p>Now your turtlebot is ready to use rtabmap with one or the other laser ! By default it will use the RPlidar, if you want to start rtabmap with the kinect laser, use this line:</p>

<pre><code>roslaunch rtabmap_ros rgbd_mapping.launch scan_topic:=/scan_kinect
</code></pre>

<h2 id="rplidar-vs-kinect-laserscan">RPlidar vs kinect laserscan</h2>

<p>In order to compare both methods in the exact same conditions, we have to record our ros_topic during the run, and provide those recorded runs to rtabmap.</p>

<p>To record them as a rosbag:</p>

<pre><code>cd bagfiles
rosbag record -O turtlebotrun /tf /odom /camera/depth_registered/camera_info /camera/depth_registered/image_raw camera/rgb/camera_info /camera/rgb/image_rect_color /scan /scan_kinect
</code></pre>

<p>To play the recorded bagfile:</p>

<pre><code>rosbag play turtlebotrun --clock
</code></pre>

<p>Here is an example of run. This is what the room we used look like I.R.L.:</p>

<p><img src="/attachments/testroom.jpg" alt="Testroom" title="Testroom" style="width: 560px">
<img src="/attachments/testroom2.jpg" alt="Testroom2" title="Testroom2" style="width: 560px"></p>

<p>Turtlebot ran around the pool table. The RTabmap run footage: (The multicolor voxels represent the rplidar scan)</p>

<div class="videowrapper">
		<iframe width="560" height="420" src="//www.youtube.com/embed/SEjo1diBlro?color=white&amp;theme=light"></iframe>
		</div>

<p>Here are the two point clouds extracted from the laser scan and the kinect laser scan during a the fast run showed above:</p>

<p><img src="/attachments/rplidarvskinect_pc.jpg" alt="rplidar vs kinect point cloud" title="rplidar vs kinect point cloud" style="width: 840px"></p>

<p>The red line is the path followed by the turtlebot.
As we can see, the results are similar except that the pool table is detected with the rplidar and not the kinect, because it was not in the kinect’s field of vision.</p>

<p>The graphview (occupancy grid) made from rtabmap looks like this:</p>

<p><img src="/attachments/rplidarvskinect.jpg" alt="rplidar vs kinect occupancy grid" title="occupancy grid" style="width: 840px"></p>

<p>A few details about the zone:
There were some holes in the cardboard around the pool table. This is why the pool table is partially filled in the rplidar scan. Also, the mess on the top corner on both screen is due to the presence of a radiator.</p>

<p>To compare both maps, we used different criterias such as the number of missing walls, the unknown surface in known area, the straightnes of the walls…
We evaluated that, on a short run, the rplidar gave better result. Its wider range gives him more information and we don’t have to look in every direction to map the area. However, if we did so, the results were similar with the kinect.
But in a real environment, and depending to the exploration algorithm used, we are more likely to be in a “fast-run” setup.</p>

				</div>

				

				
				<div class="tag_box inline">
					<i class="icon-tags"></i>

					
					


  
     
    	<a href="/tags.html#RPlidar-ref">RPlidar</a> 
     
    	<a href="/tags.html#rtabmap-ref">rtabmap</a> 
     
    	<a href="/tags.html#turtlebot-ref">turtlebot</a> 
     
    	<a href="/tags.html#laser-ref">laser</a> 
     
    	<a href="/tags.html#SLAM-ref">SLAM</a> 
    
  




				</div>
				
				<hr>

				<div class="social-button-footer">
					<p>
					<a class="btn btn-social-icon btn-twitter" href="http://twitter.com/intent/tweet?url=https://dobots.nl/2015/02/05/rplidar-with-rtabmap-on-turtlebotmd&amp;text=RPlidar%20vs%20kinect's%20laserscan%20with%20RTabmap%20on%20turtlebot"><i class="icon-twitter"></i></a>
					<a class="btn btn-social-icon btn-facebook" href="http://facebook.com/sharer.php?u=https://dobots.nl/2015/02/05/rplidar-with-rtabmap-on-turtlebotmd"><i class="icon-facebook"></i></a>
					<a class="btn btn-social-icon btn-googleplus" href="https://plus.google.com/share?url=https://dobots.nl/2015/02/05/rplidar-with-rtabmap-on-turtlebotmd"><i class="icon-googleplus"></i></a>
					<a class="btn btn-social-icon btn-linkedin" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https://dobots.nl/2015/02/05/rplidar-with-rtabmap-on-turtlebotmd"><i class="icon-linkedin"></i></a>
					<a class="btn btn-social-icon btn-reddit" href="http://reddit.com/submit?url=https://dobots.nl/2015/02/05/rplidar-with-rtabmap-on-turtlebotmd&amp;title=RPlidar%20vs%20kinect's%20laserscan%20with%20RTabmap%20on%20turtlebot"><i class="icon-reddit"></i></a>
					</p>
				</div>


				<ul class="pagination">
					
					<li class="prev"><a href="/2015/01/23/programming-the-nrf51822-with-the-st-link" title="Programming the nRF51822 with the ST-link">← Previous</a></li>
					
					<li><a href="/blog">Archive</a></li>
					
					<li class="next"><a href="/2015/03/30/attaching-a-microview-to-the-crownstone" title="Attaching a MicroView to the Crownstone">Next →</a></li>
					
				</ul>
				<hr>
				


  <div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_shortname = 'dobots'; 
    
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a>
</noscript>
<a href="https://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>




			</div>
		</div>
	</div>



<footer id="footer" class="mini-wrap gray">
	<div class="container">
		<div class="row">
			<div class="col-xs-6 col-sm-6 col-md-6 more-padding">
				<img src="/images/youtube.png" alt="youtube"> Watch our <a href="https://www.youtube.com/channel/UC7bsuzp2BfL5F5RX07oLIzw">movies</a> and follow us on <a href="http://facebook.com/dobots">Facebook!</a>
</div>
			<div class="col-xs-6 col-sm-6 col-md-6">
				<ul class="list-items pull-right gutter-top-btm">
					<li><a href="index.html">
						<img src="/images/footer-logo.png" class="img-responsive" alt="DoBots"></a></li>
					<li class="robot-info-dilog">
<a href="#">
						<img src="/images/two-robot.png" width="103" height="85" alt="robot">
					</a>
					<div class="footer-robot-dilog">
						<div class="inner-robot-dilog">
							Do you have a question? <script type="text/javascript">/*<![CDATA[*/var a=new Array(".nl","bots","do","@","fo","in");document.write("<a href='mailto:");for(i=a.length-1;i>=0;i--){document.write(a[i])}document.write("?subject=DoBots Contact' class='btn btn-default'>Yes</a>");/*]]>*/</script>
							<div class="inner-arrow-right">
								<img alt="dilog" class="img-responsive" src="/images/inner-dilog.png" draggable="false"> </div>
						</div>

					</div>
					</li>
				</ul>

			</div>
		</div>
	</div>
</footer>




  <script type="text/javascript">
window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
ga('create', 'UA-17146802-10', 'auto');
ga('send', 'pageview');
</script>
<script type="text/javascript" async src="https://www.google-analytics.com/analytics.js"></script>






<!-- in debug mode, Google Chrome worries about .map files, do not worry -->


<script type="text/javascript" src="/assets/jquery.min-7f30f220312176c728c3bb41a567ccc2e1ce2e7a8dd7c9cefd59fe197ba047b2.js"></script>

<!-- Latest compiled and minified JavaScript -->
<script src="//maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
<script type="text/javascript" src="/assets/jquery.flexslider-122776e067a7b77f685ce8fbbd3cb75136ce8ca23f243a50de28c1545ec6bb68.js"></script>

<script type="text/javascript" async src="//cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>

<script type="text/javascript">
$(window).load(function(){
		$('.text-slider').flexslider({
			animation: "slide",
			start: function(slider){
				$('body').removeClass('loading');
			}
		});
	});
</script>

</div>
</body>
</html>
